---
title: "sentiment_detection2"
author: "Frederick"
date: "6/8/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = TRUE,
	message = TRUE,
	warning = TRUE
)
```

```{r}
library(tidyverse)
library(haven)
library(skimr)
library(scales)
theme_set(theme_light())

tv_ads <- read_dta("../data/tvads_kantar_cmag.dta") 
colnames(tv_ads)


tv_eyes <- read_dta("../data/tvnews_tveyes.dta")

colnames(tv_eyes)
tv_eyes %>% 
  View()

```

* 2018 TV ads data file with human coding
* bunch of variables called issue_* that come from our data provider Kantar Media/CMAG
* Examples are issue_aarp, issue_healthcare, etc. They are indicator variables that are meant to indicate whether those issues are mentioned in the ad
* Weâ€™d prefer you to rely on WMP coding variables. They are labeled in the data set and are outlined in the attached Excel codebook.


## Explore TV Ads (video links refer to online repository)
```{r}
tv_ads %>% select(fear:sadness) %>% skim() # emotions
tv_ads %>% select(music0:music90) %>% skim() # music
tv_ads %>% select(mention1:mention32) %>% skim()
```

```{r}
filtered_ads <- tv_ads %>% 
  filter(ad_tone %in% c(2, 3)) %>% 
  mutate(ad_tone = case_when(
    ad_tone == 2 ~ "promote",
    ad_tone == 3 ~ "attack",
    TRUE         ~ "contrast"
  )) %>% 
  select(alt, link, ad_tone, categorystate, level, race) 
  
filtered_ads %>% 
  mutate(lumped_state = fct_lump(categorystate, 30),
         level = str_to_title(level),
         race = str_to_title(race)) %>% 
  select(-c(1,2), -categorystate) %>% 
  gather("var", "value", level:lumped_state) %>% 
  mutate(var = fct_relevel(var, 'level', "race")) %>% 
  add_count(ad_tone) %>% 
  ggplot(aes(value, n)) +
  geom_col() +
  scale_y_continuous(labels = scales::comma_format())  +
  coord_flip() +
  facet_wrap(~var, scales = "free_y") +
  labs(title = "Breakdown of Kantar Ads coded as Promote/Attack",
       subtitle = "Start: 01/01/2017, End: 11/06/2018",
       x = "",
       y = "")
  
  

write_csv(filtered_ads, "../data/tv_ads_attack.csv")
```




















